<% if @course.start? %>
  <% if @user_subject.start? %>
    <div class="col-md-6">
      <h3><%= @user_subject.subject.name %></h3>
      <div>
        <%= form_for :user_subject,
          url: user_course_user_subject_path(@user_course, @user_subject),
          method: :patch do |f| %>
          <%= f.hidden_field :status, value: "finish" %>
          <%= f.submit t("admin.users.end_subject"),
            class: "btn btn-success hl-button" %>
        <% end %>
      </div>
      <div class="progress">
        <div class="progress-bar progress-bar-success" role="progressbar"
          aria-valuenow="70" aria-valuemin="0" aria-valuemax="100"
          style="width:<%= @user_subject.progress %>%">
          <span><%= @user_subject.progress %> %</span>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <% @user_subject.subject.tasks.each do |task| %>
        <div>
          <h3><%= t "tasks.title" %>: <%= task.name %></h3>
          <% if task.my_task(current_user.id, @user_subject.id).present? %>
            <div class="btn btn-danger hl-button2">
              <%= t "admin.finished" %>
            </div>
          <% else %>
            <%= form_for :user_task,
              url: user_course_user_tasks_path(@course) do |f| %>
              <%= f.hidden_field :task_id, value: task.id %>
              <%= f.hidden_field :user_id, value: current_user.id %>
              <%= f.hidden_field :user_subject_id,
                value: @user_subject.id %>
              <%= f.submit t("admin.finish"),
                class: "btn btn-primary hl-button" unless current_user.supervisor? %>
            <% end %>
          <% end %>
        </div>
      <% end %>
    </div>
  <% elsif @user_subject.finish? %>
    <div class="col-md-6">
      <h3><%= @user_subject.subject.name %></h3>
      <div class="btn btn-danger hl-button2">
        <%= t "subjects.ended" %>
      </div>
      <div class="progress">
        <div class="progress-bar progress-bar-success" role="progressbar"
          aria-valuenow="70" aria-valuemin="0" aria-valuemax="100"
          style="width:<%= @user_subject.progress %>%">
          <span><%= @user_subject.progress %> %</span>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <% @user_subject.subject.tasks.each do |task| %>
        <div>
          <span><%= t "tasks.title" %>: <%= task.name %></span>
          <div class="btn btn-danger hl-button2">
            <%= t "admin.finished" %>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <% if current_user.supervisor? %>
      <div>
        <%= form_for :user_subject, html: {class: "btn"},
          url: user_course_user_subject_path(@user_course, @user_subject),
          method: :patch do |f| %>
          <%= f.hidden_field :status, value: "start" %>
          <%= f.submit t("admin.users.start_subject"),
            class: "btn btn-primary hl-button" %>
        <% end %>
      </div>
    <% else %>
      <div class="col-md-6">
        <h3><%= @user_subject.subject.name %></h3>
        <% @user_subject.subject.tasks.each do |task| %>
          <h3><%= t "tasks.title" %>: <%= task.name %></h3>
        <% end %>
      </div>
    <% end %>
  <% end %>
<% elsif @course.init? %>
  <div class="col-md-6">
    <h3><%= @user_subject.subject.name %></h3>
    <% @user_subject.subject.tasks.each do |task| %>
      <h3><%= t "tasks.title" %>: <%= task.name %></h3>
    <% end %>
  </div>
<% else %>
  <div class="col-md-6">
    <h3><%= @user_subject.subject.name %></h3>
    <div class="btn btn-danger hl-button2">
      <%= t "subjects.ended" %>
    </div>
    <div class="progress">
      <div class="progress-bar progress-bar-success" role="progressbar"
        aria-valuenow="70" aria-valuemin="0" aria-valuemax="100"
        style="width:<%= @user_subject.progress %>%">
        <span><%= @user_subject.progress %> %</span>
      </div>
    </div>
    <%= t "tasks.finish", count: @user_subject.progress %>
  </div>
  <div class="col-md-6">
    <% @user_subject.subject.tasks.each do |task| %>
      <div>
        <span><%= t "tasks.title" %>: <%= task.name %></span>
        <div class="btn btn-danger hl-button2">
          <%= t "admin.finished" %>
        </div>
      </div>
    <% end %>
  </div>
<% end %>
